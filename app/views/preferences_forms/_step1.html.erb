<div class="step-container">
  <h2 class="step-title">What are your major interests during this trip?</h2>

  <%# Gestion du formulaire pour step1 :
      - Si le preferences_form n'existe pas encore en DB (persisted? = false) → POST vers create
      - Si le preferences_form existe déjà (persisted? = true) → PATCH vers update avec step=1
      Cela permet de gérer la première création et les modifications ultérieures %>
  <% trip = preferences_form.user_trip_status&.trip || @trip %>
  <%= form_with scope: :preferences_form,
              url: preferences_form.persisted? ? trip_preferences_form_path(trip, preferences_form, step: 1) : trip_preferences_forms_path(trip),
              method: preferences_form.persisted? ? :patch : :post,
              data: { turbo_frame: "form_wrapper" },
              class: "step-form" do |f| %>

    <% sliders = {
      culture: { label: "Culture", icon: "fa-landmark" },
      food: { label: "Food", icon: "fa-utensils" },
      nightlife: { label: "Nightlife", icon: "fa-champagne-glasses" },
      nature: { label: "Nature", icon: "fa-tree" },
      shopping: { label: "Shopping", icon: "fa-bag-shopping" },
      sport: { label: "Sport", icon: "fa-person-running" }
    } %>

    <% sliders.each do |field, data| %>
      <div class="slider-row" data-controller="icon-slider">
        <label><%= data[:label] %></label>

        <div class="icon-slider">
          <div class="icon-slider-track" data-icon-slider-target="track" data-action="click->icon-slider#onTrackClick">
            <div class="icon-slider-thumb" data-icon-slider-target="thumb" data-action="mousedown->icon-slider#startDrag touchstart->icon-slider#startDrag">
              <i class="fa-solid <%= data[:icon] %>"></i>
            </div>
          </div>
          <input type="hidden"
                  name="preferences_form[<%= field %>]"
                  min="0"
                  max="100"
                  value="<%= preferences_form.send(field) || 50 %>"
                  data-icon-slider-target="input"
                  data-action="input->icon-slider#onInput">
        </div>
      </div>
    <% end %>

    <div class="button-row">
      <%= f.submit "Next →", class: "next-button" %>
    </div>

  <% end %>
</div>
